{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Artifact Versioning Schema",
  "description": "Schema for artifact versioning and history tracking",
  "type": "object",
  "required": ["artifact_id", "version", "created_by", "content"],
  "properties": {
    "artifact_id": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "description": "Unique identifier for the artifact"
    },
    "version": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
      "description": "Semantic version (e.g., 1.0.0)"
    },
    "content": {
      "type": "string",
      "description": "Artifact content (code, configuration, etc.)"
    },
    "metadata": {
      "type": "object",
      "required": ["created_at", "created_by"],
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when version was created"
        },
        "created_by": {
          "type": "string",
          "description": "Agent or user who created this version"
        },
        "modified_at": {
          "type": "string",
          "format": "date-time"
        },
        "modified_by": {
          "type": "string"
        },
        "description": {
          "type": "string",
          "description": "Change summary for this version"
        }
      }
    },
    "type": {
      "type": "string",
      "enum": ["component", "function", "module", "service", "configuration", "documentation", "dockerfile", "schema", "test", "other"],
      "description": "Type of artifact"
    },
    "language": {
      "type": "string",
      "enum": ["javascript", "typescript", "python", "go", "java", "csharp", "rust", "php", "ruby", "sql", "yaml", "json", "dockerfile", "html", "css", "other"],
      "description": "Programming language or format"
    },
    "status": {
      "type": "string",
      "enum": ["draft", "in-review", "approved", "in-use", "deprecated", "archived"],
      "description": "Current status of the artifact"
    },
    "tags": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Tags for categorization and search"
    },
    "changes": {
      "type": "object",
      "properties": {
        "summary": {
          "type": "string",
          "description": "Human-readable change summary"
        },
        "added": {
          "type": "array",
          "items": {"type": "string"},
          "description": "What was added in this version"
        },
        "modified": {
          "type": "array",
          "items": {"type": "string"},
          "description": "What was modified"
        },
        "removed": {
          "type": "array",
          "items": {"type": "string"},
          "description": "What was removed"
        },
        "breaking_changes": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Breaking changes in this version"
        }
      }
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["artifact", "version"],
        "properties": {
          "artifact": {
            "type": "string",
            "description": "Artifact ID this depends on"
          },
          "version": {
            "type": "string",
            "description": "Required version constraint (e.g., '>=1.0.0', '~2.1.0')"
          },
          "satisfied_by": {
            "type": "string",
            "description": "Currently satisfied by this version"
          }
        }
      },
      "description": "Artifacts this version depends on"
    },
    "approval": {
      "type": "object",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["pending", "approved", "rejected", "blocked"],
          "default": "pending"
        },
        "chain": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "level": {"type": "string"},
              "agent": {"type": "string"},
              "timestamp": {"type": "string", "format": "date-time"},
              "decision": {
                "type": "string",
                "enum": ["approved", "approved_with_notes", "rejected", "pending"]
              },
              "notes": {"type": "string"},
              "required_changes": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          }
        }
      }
    },
    "quality_metrics": {
      "type": "object",
      "properties": {
        "test_coverage": {"type": "number", "minimum": 0, "maximum": 100},
        "security_scan": {
          "type": "string",
          "enum": ["passed", "failed", "warning", "skipped"]
        },
        "accessibility_score": {"type": "number", "minimum": 0, "maximum": 100},
        "performance": {"type": "string", "enum": ["excellent", "good", "fair", "poor"]},
        "code_complexity": {"type": "string", "enum": ["low", "medium", "high", "critical"]},
        "vulnerabilities": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "severity": {"type": "string"},
              "description": {"type": "string"},
              "remediation": {"type": "string"}
            }
          }
        }
      }
    },
    "usage_stats": {
      "type": "object",
      "properties": {
        "created_at": {"type": "string", "format": "date-time"},
        "first_used": {"type": "string", "format": "date-time"},
        "last_accessed": {"type": "string", "format": "date-time"},
        "referenced_by_agents": {"type": "array", "items": {"type": "string"}},
        "integrated_into": {"type": "array", "items": {"type": "string"}},
        "total_integrations": {"type": "integer"},
        "download_count": {"type": "integer"}
      }
    },
    "visibility": {
      "type": "string",
      "enum": ["private", "team", "public"],
      "default": "team"
    },
    "previous_version": {
      "type": "string",
      "description": "Link to previous version"
    },
    "next_version": {
      "type": "string",
      "description": "Link to next version (when superseded)"
    },
    "can_rollback": {
      "type": "boolean",
      "description": "Whether this version can be rolled back to"
    }
  }
}

{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://agenticCoder.dev/schemas/artifacts/phase12-devops-pipelines.schema.json",
  "title": "Phase 12 DevOps Pipelines Artifact",
  "description": "Validates CI/CD pipelines and DevOps configuration output from @devops-specialist agent (Phase 12)",
  "type": "object",
  "required": ["artifact_type", "agent_id", "phase", "devops_metadata", "pipelines"],
  "properties": {
    "artifact_type": {
      "type": "string",
      "const": "devops_pipelines",
      "description": "Artifact category"
    },
    "agent_id": {
      "type": "string",
      "const": "@devops-specialist",
      "description": "Agent that produced this artifact"
    },
    "phase": {
      "type": "integer",
      "const": 12,
      "description": "Phase number"
    },
    "devops_metadata": {
      "type": "object",
      "required": ["ci_cd_platform", "pipelines_created"],
      "properties": {
        "ci_cd_platform": {
          "type": "string",
          "enum": ["GitHub Actions", "Azure DevOps", "Jenkins", "GitLab CI", "CircleCI", "Travis CI"]
        },
        "container_platform": {
          "type": "string",
          "enum": ["Docker", "Podman"]
        },
        "orchestration_platform": {
          "type": "string",
          "enum": ["Kubernetes", "Docker Swarm", "AWS ECS", "Azure Container Instances"]
        },
        "pipelines_created": {
          "type": "integer",
          "minimum": 3
        }
      }
    },
    "pipelines": {
      "type": "array",
      "minItems": 3,
      "items": {
        "type": "object",
        "required": ["pipeline_name", "pipeline_type", "trigger_events"],
        "properties": {
          "pipeline_name": {
            "type": "string"
          },
          "pipeline_file": {
            "type": "string",
            "description": "Path to pipeline definition file"
          },
          "pipeline_type": {
            "type": "string",
            "enum": ["Build", "Test", "Deploy", "Release", "Security Scan", "Performance Test"]
          },
          "trigger_events": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string",
              "enum": ["Push", "Pull Request", "Schedule", "Manual", "Tag", "Release"]
            }
          },
          "branches": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Branches this pipeline runs on"
          },
          "stages": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "properties": {
                "stage_name": {
                  "type": "string"
                },
                "order": {
                  "type": "integer"
                },
                "parallel_execution": {
                  "type": "boolean"
                },
                "jobs": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "job_name": {
                        "type": "string"
                      },
                      "runner_type": {
                        "type": "string"
                      },
                      "steps": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "step_name": {
                              "type": "string"
                            },
                            "command": {
                              "type": "string"
                            },
                            "script": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "timeout_minutes": {
                        "type": "integer"
                      },
                      "retry_count": {
                        "type": "integer"
                      }
                    }
                  }
                }
              }
            }
          },
          "dependencies": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "notifications": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "event": {
                  "type": "string",
                  "enum": ["Success", "Failure", "Always"]
                },
                "notification_type": {
                  "type": "string",
                  "enum": ["Email", "Slack", "Teams", "Webhook"]
                },
                "recipients": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    },
    "docker_configuration": {
      "type": "object",
      "properties": {
        "dockerfiles": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "path": {
                "type": "string"
              },
              "base_image": {
                "type": "string"
              },
              "purpose": {
                "type": "string"
              },
              "build_stages": {
                "type": "integer"
              }
            }
          }
        },
        "docker_compose_files": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "file_name": {
                "type": "string"
              },
              "services": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "container_registry": {
          "type": "string",
          "enum": ["Docker Hub", "Azure Container Registry", "AWS ECR", "Google Artifact Registry"]
        },
        "registry_url": {
          "type": "string"
        }
      }
    },
    "kubernetes_configuration": {
      "type": "object",
      "properties": {
        "manifests": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "manifest_name": {
                "type": "string"
              },
              "manifest_path": {
                "type": "string"
              },
              "kind": {
                "type": "string",
                "enum": ["Deployment", "Service", "Ingress", "ConfigMap", "Secret", "StatefulSet"]
              },
              "resources": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "helm_charts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "chart_name": {
                "type": "string"
              },
              "chart_location": {
                "type": "string"
              },
              "values_files": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "namespaces": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "environment_management": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["environment_name"],
        "properties": {
          "environment_name": {
            "type": "string",
            "enum": ["Development", "Staging", "Production"]
          },
          "deployment_target": {
            "type": "string"
          },
          "infrastructure": {
            "type": "string"
          },
          "auto_deploy_enabled": {
            "type": "boolean"
          },
          "approval_required": {
            "type": "boolean"
          },
          "deployment_slots": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "security_scanning": {
      "type": "object",
      "properties": {
        "code_scanning": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "tool_name": {
                "type": "string"
              },
              "enabled": {
                "type": "boolean"
              },
              "schedule": {
                "type": "string"
              }
            }
          }
        },
        "dependency_scanning": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "tool_name": {
                "type": "string"
              },
              "enabled": {
                "type": "boolean"
              }
            }
          }
        },
        "container_scanning": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "tool_name": {
                "type": "string"
              },
              "registry_scanning": {
                "type": "boolean"
              }
            }
          }
        },
        "secret_scanning": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "tool": {
              "type": "string"
            }
          }
        }
      }
    },
    "testing_in_pipeline": {
      "type": "object",
      "properties": {
        "unit_tests": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "framework": {
              "type": "string"
            },
            "coverage_requirement": {
              "type": "number"
            }
          }
        },
        "integration_tests": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "framework": {
              "type": "string"
            }
          }
        },
        "e2e_tests": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "framework": {
              "type": "string"
            }
          }
        },
        "performance_tests": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "tool": {
              "type": "string"
            }
          }
        }
      }
    },
    "build_configuration": {
      "type": "object",
      "properties": {
        "artifact_storage": {
          "type": "string"
        },
        "artifact_retention": {
          "type": "object",
          "properties": {
            "days": {
              "type": "integer"
            },
            "keep_latest": {
              "type": "integer"
            }
          }
        },
        "build_cache": {
          "type": "boolean"
        },
        "parallel_builds": {
          "type": "integer"
        }
      }
    },
    "deployment_strategy": {
      "type": "object",
      "properties": {
        "deployment_type": {
          "type": "string",
          "enum": ["Blue-Green", "Canary", "Rolling", "Recreate", "Shadow"]
        },
        "deployment_frequency": {
          "type": "string"
        },
        "rollback_strategy": {
          "type": "string"
        },
        "deployment_validation": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "monitoring_and_alerting": {
      "type": "object",
      "properties": {
        "monitoring_tools": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "tool_name": {
                "type": "string"
              },
              "metrics_collected": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "log_aggregation": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "platform": {
              "type": "string"
            }
          }
        },
        "alerts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "alert_name": {
                "type": "string"
              },
              "condition": {
                "type": "string"
              },
              "notification_channels": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "dashboards": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "health_checks": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "health_check_name": {
            "type": "string"
          },
          "endpoint": {
            "type": "string"
          },
          "frequency_seconds": {
            "type": "integer"
          },
          "timeout_seconds": {
            "type": "integer"
          },
          "success_threshold": {
            "type": "integer"
          }
        }
      }
    },
    "secrets_management": {
      "type": "object",
      "properties": {
        "secrets_store": {
          "type": "string",
          "enum": ["Azure Key Vault", "AWS Secrets Manager", "HashiCorp Vault", "GitHub Secrets"]
        },
        "secret_rotation": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "rotation_frequency_days": {
              "type": "integer"
            }
          }
        },
        "secrets_in_pipeline": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "secret_name": {
                "type": "string"
              },
              "usage": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "infrastructure_as_code": {
      "type": "object",
      "properties": {
        "iac_tool": {
          "type": "string",
          "enum": ["Bicep", "Terraform", "CloudFormation", "Pulumi"]
        },
        "iac_files": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "infrastructure_deployment_pipeline": {
          "type": "string"
        },
        "terraform_state": {
          "type": "object",
          "properties": {
            "backend": {
              "type": "string"
            },
            "locking": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "backup_and_disaster_recovery": {
      "type": "object",
      "properties": {
        "backup_frequency": {
          "type": "string"
        },
        "backup_locations": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "disaster_recovery_plan": {
          "type": "string"
        },
        "rpo_hours": {
          "type": "number"
        },
        "rto_hours": {
          "type": "number"
        },
        "backup_testing_schedule": {
          "type": "string"
        }
      }
    },
    "compliance_and_governance": {
      "type": "object",
      "properties": {
        "compliance_standards": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "audit_logging": {
          "type": "boolean"
        },
        "policy_enforcement": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "documentation": {
      "type": "object",
      "properties": {
        "pipeline_documentation": {
          "type": "string"
        },
        "runbook_location": {
          "type": "string"
        },
        "troubleshooting_guide": {
          "type": "string"
        }
      }
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    }
  }
}

# Artifact Registry Specification

**Version**: 1.0  
**Date**: January 13, 2026  
**Status**: APPROVED for Implementation

---

## 1. Overview

This document defines the **Artifact Registry** system for storing, retrieving, and managing artifacts generated by agents in the AgenticCoder system. Artifacts are structured outputs produced by agents that serve as inputs for subsequent phases or final deliverables.

---

## 2. Artifact Storage Strategy

### File-Based Artifact Storage

**Storage Location**: `d:\repositories\AgenticCoder\artifacts\`

**Directory Structure**:
```
d:\repositories\AgenticCoder\
â””â”€ artifacts\
   â”œâ”€ registry.json                    # Master artifact index
   â”‚
   â”œâ”€ phase-07-tech-stack\             # Phase 7: Tech Stack Decisions
   â”‚  â”œâ”€ artifact-tech-stack-001.json
   â”‚  â””â”€ artifact-tech-stack-002.json
   â”‚
   â”œâ”€ phase-11-frontend-requirements\  # Phase 11: Frontend Requirements
   â”‚  â”œâ”€ artifact-frontend-req-001.json
   â”‚  â””â”€ artifact-frontend-req-002.json
   â”‚
   â”œâ”€ phase-13-react\                  # Phase 13: React Components
   â”‚  â”œâ”€ artifact-react-comp-001.json
   â”‚  â”œâ”€ artifact-react-comp-002.json
   â”‚  â””â”€ components\                   # Actual generated files
   â”‚     â”œâ”€ UserProfile.tsx
   â”‚     â”œâ”€ UserProfile.test.tsx
   â”‚     â””â”€ useUserData.ts
   â”‚
   â”œâ”€ phase-14-dotnet\                 # Phase 14: .NET APIs
   â”‚  â”œâ”€ artifact-dotnet-api-001.json
   â”‚  â””â”€ controllers\                  # Actual generated files
   â”‚     â”œâ”€ UsersController.cs
   â”‚     â”œâ”€ UserService.cs
   â”‚     â””â”€ UsersControllerTests.cs
   â”‚
   â”œâ”€ phase-15-database\               # Phase 15: Database Schemas
   â”‚  â”œâ”€ artifact-sql-schema-001.json
   â”‚  â””â”€ schemas\                      # Actual generated files
   â”‚     â”œâ”€ CreateUsersTable.sql
   â”‚     â””â”€ 001_CreateUsers.migration.sql
   â”‚
   â””â”€ phase-16-azure-devops\           # Phase 16: CI/CD Pipelines
      â”œâ”€ artifact-azure-pipeline-001.json
      â””â”€ pipelines\                    # Actual generated files
         â””â”€ azure-pipelines.yml
```

---

## 3. Artifact Naming Convention

### Artifact ID Format

```
artifact-{agent-type}-{artifact-type}-{timestamp}.json
```

**Examples**:
- `artifact-tech-stack-001-1705147200000.json`
- `artifact-react-comp-001-1705147532000.json`
- `artifact-dotnet-api-001-1705148000000.json`

**Components**:
- `{agent-type}`: Short agent identifier (tech-stack, react-comp, dotnet-api, sql-schema, azure-pipeline)
- `{artifact-type}`: Type of artifact (optional, can be part of agent-type)
- `{timestamp}`: Unix timestamp in milliseconds (ensures uniqueness)

---

## 4. Artifact Schema

### Master Registry Schema

**File**: `artifacts/registry.json`

```json
{
  "registry_version": "1.0",
  "project_id": "proj-001",
  "project_name": "UserManagement-API",
  "created_at": "2026-01-13T10:00:00Z",
  "last_updated": "2026-01-13T10:30:00Z",
  
  "artifacts": [
    {
      "artifact_id": "artifact-tech-stack-001-1705147200000",
      "artifact_type": "tech-stack-decision",
      "phase": 7,
      "agent_id": "@code-architect",
      "file_path": "artifacts/phase-07-tech-stack/artifact-tech-stack-001-1705147200000.json",
      "created_at": "2026-01-13T10:00:00Z",
      "status": "active",
      "dependencies": [],
      "dependents": [
        "artifact-frontend-req-001-1705147300000",
        "artifact-react-comp-001-1705147532000"
      ],
      "metadata": {
        "tech_stack": {
          "frontend": "React",
          "backend": ".NET",
          "database": "SQL Server",
          "ci_cd": "Azure DevOps"
        }
      }
    },
    {
      "artifact_id": "artifact-react-comp-001-1705147532000",
      "artifact_type": "react-components",
      "phase": 13,
      "agent_id": "@react-specialist",
      "file_path": "artifacts/phase-13-react/artifact-react-comp-001-1705147532000.json",
      "created_at": "2026-01-13T10:05:32Z",
      "status": "active",
      "dependencies": [
        "artifact-tech-stack-001-1705147200000",
        "artifact-frontend-req-001-1705147300000"
      ],
      "dependents": [],
      "metadata": {
        "components_generated": 1,
        "total_lines": 290,
        "validation_status": "passed"
      }
    }
  ],
  
  "statistics": {
    "total_artifacts": 2,
    "artifacts_by_phase": {
      "7": 1,
      "13": 1
    },
    "artifacts_by_type": {
      "tech-stack-decision": 1,
      "react-components": 1
    }
  }
}
```

---

### Individual Artifact Schema

**File**: `artifacts/phase-13-react/artifact-react-comp-001-1705147532000.json`

```json
{
  "artifact_id": "artifact-react-comp-001-1705147532000",
  "artifact_type": "react-components",
  "artifact_version": "1.0",
  "schema_version": "1.0",
  
  "metadata": {
    "phase": 13,
    "agent_id": "@react-specialist",
    "created_at": "2026-01-13T10:05:32Z",
    "created_by": "handoff-hoff-001-1705147200000",
    "project_id": "proj-001",
    "status": "active"
  },
  
  "dependencies": {
    "required": [
      {
        "artifact_id": "artifact-tech-stack-001-1705147200000",
        "artifact_type": "tech-stack-decision",
        "reason": "Determines React version and dependencies"
      },
      {
        "artifact_id": "artifact-frontend-req-001-1705147300000",
        "artifact_type": "frontend-requirements",
        "reason": "Defines component specifications"
      }
    ],
    "optional": []
  },
  
  "content": {
    "components": [
      {
        "name": "UserProfile",
        "file_path": "artifacts/phase-13-react/components/UserProfile.tsx",
        "component_type": "functional",
        "hooks_used": ["useState", "useEffect", "useContext"],
        "custom_hooks": ["useUserData"],
        "props_interface": "IUserProfileProps",
        "state_variables": ["user", "isEditing", "isSaving"],
        "event_handlers": ["handleEdit", "handleSave", "handleCancel"],
        "code_length_lines": 150,
        "imports": ["React", "useContext", "useCallback"],
        "dependencies": ["react@18.2", "axios@1.6"],
        "test_file": "artifacts/phase-13-react/components/UserProfile.test.tsx",
        "test_cases": 8,
        "accessibility_features": ["aria-label", "role", "semantic-html"],
        "performance_optimizations": ["React.memo", "useCallback"]
      }
    ],
    
    "custom_hooks": [
      {
        "name": "useUserData",
        "file_path": "artifacts/phase-13-react/components/useUserData.ts",
        "description": "Fetch and manage user data with caching",
        "returns": "{ user, loading, error, refetch }",
        "code_length_lines": 60
      }
    ],
    
    "context_providers": [],
    
    "generated_files": [
      "artifacts/phase-13-react/components/UserProfile.tsx",
      "artifacts/phase-13-react/components/UserProfile.test.tsx",
      "artifacts/phase-13-react/components/useUserData.ts"
    ]
  },
  
  "validation": {
    "status": "passed",
    "timestamp": "2026-01-13T10:05:30Z",
    "checks": {
      "typescript_errors": {
        "status": "passed",
        "value": 0,
        "threshold": 0
      },
      "eslint_warnings": {
        "status": "passed",
        "value": 0,
        "threshold": 0
      },
      "tests_passing": {
        "status": "passed",
        "value": true
      },
      "coverage_percentage": {
        "status": "passed",
        "value": 87,
        "threshold": 80
      },
      "accessibility_violations": {
        "status": "passed",
        "value": 0,
        "threshold": 0
      }
    }
  },
  
  "quality_metrics": {
    "total_lines": 290,
    "cyclomatic_complexity": 12,
    "maintainability_index": 78,
    "bundle_impact_kb": 15.3
  },
  
  "recommendations": [
    "Consider adding error boundary for UserProfile component",
    "Add loading skeleton for better UX",
    "Implement optimistic updates for save operations"
  ]
}
```

---

## 5. Artifact Access Patterns

### Pattern 1: Register New Artifact

```python
import json
import os
from datetime import datetime

def register_artifact(artifact_data):
    """
    Register a new artifact in the master registry.
    """
    registry_path = "artifacts/registry.json"
    
    # Load existing registry
    if os.path.exists(registry_path):
        with open(registry_path, 'r') as f:
            registry = json.load(f)
    else:
        registry = {
            "registry_version": "1.0",
            "project_id": "proj-001",
            "created_at": datetime.utcnow().isoformat() + "Z",
            "artifacts": [],
            "statistics": {
                "total_artifacts": 0,
                "artifacts_by_phase": {},
                "artifacts_by_type": {}
            }
        }
    
    # Add artifact
    registry["artifacts"].append(artifact_data)
    registry["last_updated"] = datetime.utcnow().isoformat() + "Z"
    
    # Update statistics
    registry["statistics"]["total_artifacts"] += 1
    
    phase = str(artifact_data["phase"])
    registry["statistics"]["artifacts_by_phase"][phase] = \
        registry["statistics"]["artifacts_by_phase"].get(phase, 0) + 1
    
    artifact_type = artifact_data["artifact_type"]
    registry["statistics"]["artifacts_by_type"][artifact_type] = \
        registry["statistics"]["artifacts_by_type"].get(artifact_type, 0) + 1
    
    # Save registry
    with open(registry_path, 'w') as f:
        json.dump(registry, f, indent=2)
    
    print(f"âœ… Artifact registered: {artifact_data['artifact_id']}")
```

---

### Pattern 2: Retrieve Artifact by ID

```python
def get_artifact_by_id(artifact_id):
    """
    Retrieve artifact metadata and content by ID.
    """
    registry_path = "artifacts/registry.json"
    
    if not os.path.exists(registry_path):
        raise FileNotFoundError("Artifact registry not found")
    
    with open(registry_path, 'r') as f:
        registry = json.load(f)
    
    # Find artifact in registry
    artifact_entry = None
    for artifact in registry["artifacts"]:
        if artifact["artifact_id"] == artifact_id:
            artifact_entry = artifact
            break
    
    if not artifact_entry:
        raise ValueError(f"Artifact not found: {artifact_id}")
    
    # Load artifact content
    artifact_path = artifact_entry["file_path"]
    if not os.path.exists(artifact_path):
        raise FileNotFoundError(f"Artifact file not found: {artifact_path}")
    
    with open(artifact_path, 'r') as f:
        artifact_content = json.load(f)
    
    return artifact_content
```

---

### Pattern 3: Find Artifacts by Type

```python
def find_artifacts_by_type(artifact_type):
    """
    Find all artifacts of a specific type.
    """
    registry_path = "artifacts/registry.json"
    
    if not os.path.exists(registry_path):
        return []
    
    with open(registry_path, 'r') as f:
        registry = json.load(f)
    
    matching_artifacts = [
        artifact for artifact in registry["artifacts"]
        if artifact["artifact_type"] == artifact_type
    ]
    
    return matching_artifacts
```

---

### Pattern 4: Find Artifacts by Phase

```python
def find_artifacts_by_phase(phase):
    """
    Find all artifacts from a specific phase.
    """
    registry_path = "artifacts/registry.json"
    
    if not os.path.exists(registry_path):
        return []
    
    with open(registry_path, 'r') as f:
        registry = json.load(f)
    
    matching_artifacts = [
        artifact for artifact in registry["artifacts"]
        if artifact["phase"] == phase
    ]
    
    return matching_artifacts
```

---

### Pattern 5: Get Artifact Dependencies

```python
def get_artifact_dependencies(artifact_id):
    """
    Get all dependencies for a specific artifact.
    """
    artifact = get_artifact_by_id(artifact_id)
    
    dependencies = artifact.get("dependencies", {}).get("required", [])
    
    # Load each dependency
    dependency_artifacts = []
    for dep in dependencies:
        dep_artifact = get_artifact_by_id(dep["artifact_id"])
        dependency_artifacts.append(dep_artifact)
    
    return dependency_artifacts
```

---

### Pattern 6: Update Artifact Status

```python
def update_artifact_status(artifact_id, new_status):
    """
    Update the status of an artifact (active, deprecated, archived).
    """
    registry_path = "artifacts/registry.json"
    
    with open(registry_path, 'r') as f:
        registry = json.load(f)
    
    # Find and update artifact
    for artifact in registry["artifacts"]:
        if artifact["artifact_id"] == artifact_id:
            artifact["status"] = new_status
            artifact["status_updated_at"] = datetime.utcnow().isoformat() + "Z"
            break
    
    registry["last_updated"] = datetime.utcnow().isoformat() + "Z"
    
    # Save registry
    with open(registry_path, 'w') as f:
        json.dump(registry, f, indent=2)
    
    print(f"âœ… Artifact status updated: {artifact_id} â†’ {new_status}")
```

---

## 6. Artifact Lifecycle

### State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CREATED â”‚  â† Agent generates artifact
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Validation passes
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ACTIVE  â”‚  â† Available for consumption by other agents
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Superseded by newer version OR no longer needed
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEPRECATED â”‚  â† Still available but not recommended
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Archived for historical purposes
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHIVED â”‚  â† Read-only, not actively used
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Artifact Type Definitions

### Phase 7: Tech Stack Decision

**Type**: `tech-stack-decision`  
**Schema**: `tech-stack-decision.artifact.schema.json`

```json
{
  "artifact_type": "tech-stack-decision",
  "content": {
    "decisions": {
      "frontend": { "framework": "React", "version": "18.2" },
      "backend": { "framework": "ASP.NET Core", "version": "8.0" },
      "database": { "system": "SQL Server" },
      "ci_cd": { "platform": "Azure DevOps" }
    },
    "rationale": "...",
    "alternatives_considered": [...]
  }
}
```

---

### Phase 13: React Components

**Type**: `react-components`  
**Schema**: `react-components.artifact.schema.json`

```json
{
  "artifact_type": "react-components",
  "content": {
    "components": [...],
    "custom_hooks": [...],
    "context_providers": [...],
    "generated_files": [...]
  },
  "validation": { "status": "passed", ... }
}
```

---

### Phase 14: .NET Controllers

**Type**: `dotnet-controllers`  
**Schema**: `dotnet-controllers.artifact.schema.json`

```json
{
  "artifact_type": "dotnet-controllers",
  "content": {
    "controllers": [...],
    "services": [...],
    "entities": [...],
    "db_context": {...},
    "migrations": [...],
    "generated_files": [...]
  },
  "validation": { "status": "passed", ... }
}
```

---

### Phase 15: SQL Schema

**Type**: `sql-schema`  
**Schema**: `sql-schema.artifact.schema.json`

```json
{
  "artifact_type": "sql-schema",
  "content": {
    "tables": [...],
    "indexes": [...],
    "stored_procedures": [...],
    "migrations": [...],
    "generated_files": [...]
  },
  "validation": { "status": "passed", ... }
}
```

---

### Phase 16: Azure Pipeline

**Type**: `azure-pipeline`  
**Schema**: `azure-pipeline.artifact.schema.json`

```json
{
  "artifact_type": "azure-pipeline",
  "content": {
    "pipeline_name": "...",
    "stages": [...],
    "environments": [...],
    "quality_gates": [...],
    "generated_files": [...]
  },
  "validation": { "status": "passed", ... }
}
```

---

## 8. Artifact Validation

### Validation Checks

Every artifact must pass validation before being marked as `active`:

1. **Schema Validation**: Artifact structure matches schema
2. **Dependency Validation**: All required dependencies exist
3. **Content Validation**: Generated files exist and compile
4. **Quality Gates**: Metrics meet thresholds (coverage, errors, etc.)

### Validation Script Example

```python
def validate_artifact(artifact_path):
    """
    Validate an artifact against its schema and quality gates.
    """
    with open(artifact_path, 'r') as f:
        artifact = json.load(f)
    
    # Schema validation
    schema_file = f"schemas/artifacts/{artifact['artifact_type']}.artifact.schema.json"
    validate_json_schema(artifact, schema_file)
    
    # Dependency validation
    for dep in artifact.get("dependencies", {}).get("required", []):
        if not artifact_exists(dep["artifact_id"]):
            raise ValueError(f"Dependency not found: {dep['artifact_id']}")
    
    # Content validation (check generated files exist)
    for file_path in artifact["content"].get("generated_files", []):
        if not os.path.exists(file_path):
            raise FileNotFoundError(f"Generated file not found: {file_path}")
    
    # Quality gates
    validation = artifact.get("validation", {})
    if validation.get("status") != "passed":
        raise ValueError("Artifact validation failed")
    
    print("âœ… Artifact validation passed")
    return True
```

---

## 9. Cleanup and Maintenance

### Artifact Cleanup Policy

**ACTIVE**: Keep indefinitely  
**DEPRECATED**: Keep for 30 days  
**ARCHIVED**: Keep for 90 days, then delete  

### Cleanup Script

```python
def cleanup_old_artifacts():
    """
    Archive or delete old artifacts based on policy.
    """
    registry_path = "artifacts/registry.json"
    
    with open(registry_path, 'r') as f:
        registry = json.load(f)
    
    now = datetime.utcnow()
    
    for artifact in registry["artifacts"]:
        status = artifact["status"]
        updated_at = datetime.fromisoformat(artifact.get("status_updated_at", artifact["created_at"]).rstrip("Z"))
        age_days = (now - updated_at).days
        
        if status == "deprecated" and age_days > 30:
            # Move to archived
            artifact["status"] = "archived"
            artifact["status_updated_at"] = now.isoformat() + "Z"
            print(f"ğŸ“¦ Archived: {artifact['artifact_id']}")
        
        elif status == "archived" and age_days > 90:
            # Delete artifact file
            os.remove(artifact["file_path"])
            registry["artifacts"].remove(artifact)
            print(f"ğŸ—‘ï¸ Deleted: {artifact['artifact_id']}")
    
    # Save updated registry
    with open(registry_path, 'w') as f:
        json.dump(registry, f, indent=2)
```

---

## 10. Success Criteria

âœ… Artifacts stored in consistent location  
âœ… Master registry tracks all artifacts  
âœ… Artifact naming convention enforced  
âœ… Artifacts can be retrieved by ID, type, or phase  
âœ… Artifact dependencies tracked  
âœ… Artifact validation enforced  
âœ… Artifact lifecycle managed (active â†’ deprecated â†’ archived)  

---

## 11. Next Steps

1. âœ… **HANDOFF_PROTOCOL.md** - COMPLETE
2. âœ… **ARTIFACT_REGISTRY.md** - COMPLETE
3. â³ **VALIDATION_STRATEGY.md** - Create test-first validation approach
4. â³ **Implement React E2E** - Test artifact registry with real React component generation

---

**Status**: âœ… APPROVED for Implementation  
**Last Updated**: January 13, 2026

# Docker Compose Template: {{projectName}}
# {{description}}
# Generated by AgenticCoder

version: '3.8'

services:
  {{#each services}}
  # Service: {{name}}
  {{kebabCase name}}:
    {{#if build}}
    build:
      context: {{build.context}}
      dockerfile: {{build.dockerfile}}
      {{#if build.args}}
      args:
        {{#each build.args}}
        - {{key}}={{value}}
        {{/each}}
      {{/if}}
      {{#if build.target}}
      target: {{build.target}}
      {{/if}}
    {{else}}
    image: {{image}}
    {{/if}}
    container_name: {{kebabCase ../projectName}}-{{kebabCase name}}
    {{#if command}}
    command: {{command}}
    {{/if}}
    {{#if entrypoint}}
    entrypoint: {{entrypoint}}
    {{/if}}
    {{#if ports}}
    ports:
      {{#each ports}}
      - "{{this}}"
      {{/each}}
    {{/if}}
    {{#if expose}}
    expose:
      {{#each expose}}
      - "{{this}}"
      {{/each}}
    {{/if}}
    {{#if environment}}
    environment:
      {{#each environment}}
      {{key}}: {{value}}
      {{/each}}
    {{/if}}
    {{#if envFile}}
    env_file:
      {{#each envFile}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if volumes}}
    volumes:
      {{#each volumes}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if networks}}
    networks:
      {{#each networks}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if dependsOn}}
    depends_on:
      {{#each dependsOn}}
      {{#if condition}}
      {{service}}:
        condition: {{condition}}
      {{else}}
      - {{this}}
      {{/if}}
      {{/each}}
    {{/if}}
    {{#if healthcheck}}
    healthcheck:
      test: {{healthcheck.test}}
      interval: {{healthcheck.interval}}
      timeout: {{healthcheck.timeout}}
      retries: {{healthcheck.retries}}
      {{#if healthcheck.startPeriod}}
      start_period: {{healthcheck.startPeriod}}
      {{/if}}
    {{/if}}
    {{#if deploy}}
    deploy:
      {{#if deploy.replicas}}
      replicas: {{deploy.replicas}}
      {{/if}}
      {{#if deploy.resources}}
      resources:
        {{#if deploy.resources.limits}}
        limits:
          {{#if deploy.resources.limits.cpus}}
          cpus: '{{deploy.resources.limits.cpus}}'
          {{/if}}
          {{#if deploy.resources.limits.memory}}
          memory: {{deploy.resources.limits.memory}}
          {{/if}}
        {{/if}}
        {{#if deploy.resources.reservations}}
        reservations:
          {{#if deploy.resources.reservations.cpus}}
          cpus: '{{deploy.resources.reservations.cpus}}'
          {{/if}}
          {{#if deploy.resources.reservations.memory}}
          memory: {{deploy.resources.reservations.memory}}
          {{/if}}
        {{/if}}
      {{/if}}
      {{#if deploy.restartPolicy}}
      restart_policy:
        condition: {{deploy.restartPolicy.condition}}
        {{#if deploy.restartPolicy.delay}}
        delay: {{deploy.restartPolicy.delay}}
        {{/if}}
        {{#if deploy.restartPolicy.maxAttempts}}
        max_attempts: {{deploy.restartPolicy.maxAttempts}}
        {{/if}}
      {{/if}}
    {{/if}}
    {{#if restart}}
    restart: {{restart}}
    {{/if}}
    {{#if labels}}
    labels:
      {{#each labels}}
      {{key}}: "{{value}}"
      {{/each}}
    {{/if}}
    {{#if logging}}
    logging:
      driver: {{logging.driver}}
      {{#if logging.options}}
      options:
        {{#each logging.options}}
        {{key}}: "{{value}}"
        {{/each}}
      {{/if}}
    {{/if}}

  {{/each}}

{{#if networks}}
networks:
  {{#each networks}}
  {{name}}:
    {{#if driver}}
    driver: {{driver}}
    {{/if}}
    {{#if external}}
    external: {{external}}
    {{/if}}
    {{#if ipam}}
    ipam:
      driver: {{ipam.driver}}
      config:
        {{#each ipam.config}}
        - subnet: {{subnet}}
          {{#if gateway}}
          gateway: {{gateway}}
          {{/if}}
        {{/each}}
    {{/if}}
  {{/each}}
{{/if}}

{{#if volumes}}
volumes:
  {{#each volumes}}
  {{name}}:
    {{#if driver}}
    driver: {{driver}}
    {{/if}}
    {{#if external}}
    external: {{external}}
    {{/if}}
    {{#if driverOpts}}
    driver_opts:
      {{#each driverOpts}}
      {{key}}: {{value}}
      {{/each}}
    {{/if}}
  {{/each}}
{{/if}}

{{#if secrets}}
secrets:
  {{#each secrets}}
  {{name}}:
    {{#if file}}
    file: {{file}}
    {{/if}}
    {{#if external}}
    external: {{external}}
    {{/if}}
  {{/each}}
{{/if}}

{{#if configs}}
configs:
  {{#each configs}}
  {{name}}:
    {{#if file}}
    file: {{file}}
    {{/if}}
    {{#if external}}
    external: {{external}}
    {{/if}}
  {{/each}}
{{/if}}

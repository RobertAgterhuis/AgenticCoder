-- PostgreSQL Seed Data Template
-- {{description}}
-- Generated by AgenticCoder

-- Disable foreign key checks during seeding (optional)
-- SET session_replication_role = 'replica';

BEGIN;

{{#each seeds}}
-- Seed data for {{table}}
{{#if truncate}}
TRUNCATE TABLE {{snakeCase table}} {{#if cascade}}CASCADE{{/if}} RESTART IDENTITY;
{{/if}}

INSERT INTO {{snakeCase table}} ({{#each columns}}{{snakeCase this}}{{#unless @last}}, {{/unless}}{{/each}})
VALUES
{{#each rows}}
    ({{#each this}}{{#if (isString this)}}'{{this}}'{{else}}{{this}}{{/if}}{{#unless @last}}, {{/unless}}{{/each}}){{#unless @last}},{{/unless}}
{{/each}}
{{#if onConflict}}
ON CONFLICT ({{onConflict.columns}}) DO {{#if onConflict.update}}UPDATE SET {{onConflict.update}}{{else}}NOTHING{{/if}}
{{/if}};

{{/each}}

{{#if sequences}}
-- Reset sequences
{{#each sequences}}
SELECT setval('{{name}}', (SELECT COALESCE(MAX({{column}}), 0) + 1 FROM {{table}}), false);
{{/each}}
{{/if}}

COMMIT;

-- Re-enable foreign key checks
-- SET session_replication_role = 'origin';

-- Verify seed data
{{#each seeds}}
SELECT COUNT(*) as {{snakeCase table}}_count FROM {{snakeCase table}};
{{/each}}

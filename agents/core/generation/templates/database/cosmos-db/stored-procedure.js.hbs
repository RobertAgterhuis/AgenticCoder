/**
 * Cosmos DB Stored Procedure: {{name}}
 * {{description}}
 * 
 * Generated by AgenticCoder
 */

function {{camelCase name}}({{#each params}}{{name}}{{#unless @last}}, {{/unless}}{{/each}}) {
    var context = getContext();
    var container = context.getCollection();
    var response = context.getResponse();
    
    {{#if validation}}
    // Input validation
    {{#each validation}}
    if ({{condition}}) {
        throw new Error('{{message}}');
    }
    {{/each}}
    {{/if}}
    
    {{#if transaction}}
    // Transactional batch operations
    var accepted = container.createDocument(
        container.getSelfLink(),
        {{documentBody}},
        function(err, createdDoc) {
            if (err) {
                throw new Error('Error creating document: ' + err.message);
            }
            
            {{transactionBody}}
        }
    );
    
    if (!accepted) {
        throw new Error('The stored procedure timed out.');
    }
    {{else}}
    {{body}}
    {{/if}}
}

{{#if helpers}}
// Helper functions
{{#each helpers}}
function {{name}}({{params}}) {
    {{body}}
}

{{/each}}
{{/if}}

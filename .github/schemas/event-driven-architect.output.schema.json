{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "event-driven-architect.output.schema.json",
  "title": "Event-Driven Architect Output",
  "description": "Output schema for @event-driven-architect agent",
  "type": "object",
  "required": ["event_architecture", "status"],
  "properties": {
    "status": {
      "type": "string",
      "enum": ["success", "partial", "needs_input", "failed"]
    },
    "event_architecture": {
      "type": "object",
      "properties": {
        "overview": {
          "type": "string",
          "description": "High-level event architecture description"
        },
        "events_catalog": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "event_type": { "type": "string" },
              "version": { "type": "string" },
              "description": { "type": "string" },
              "schema": { "type": "object" },
              "producers": {
                "type": "array",
                "items": { "type": "string" }
              },
              "consumers": {
                "type": "array",
                "items": { "type": "string" }
              },
              "ordering_key": { "type": "string" },
              "retention": { "type": "string" }
            }
          }
        },
        "topics_and_subscriptions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "topic_name": { "type": "string" },
              "partitioning": { "type": "boolean" },
              "subscriptions": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": { "type": "string" },
                    "filter": { "type": "string" },
                    "consumer_service": { "type": "string" }
                  }
                }
              }
            }
          }
        },
        "infrastructure": {
          "type": "object",
          "properties": {
            "messaging_platform": { "type": "string" },
            "event_store": { "type": "string" },
            "dead_letter_strategy": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "max_delivery_count": { "type": "integer" },
                "alert_threshold": { "type": "integer" }
              }
            }
          }
        },
        "patterns_used": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "publish-subscribe",
              "event-sourcing",
              "cqrs",
              "saga-choreography",
              "saga-orchestration",
              "outbox",
              "inbox"
            ]
          }
        }
      }
    },
    "code_artifacts": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "file_path": { "type": "string" },
          "content_type": {
            "type": "string",
            "enum": ["event-schema", "publisher", "consumer", "handler", "infrastructure"]
          },
          "language": { "type": "string" }
        }
      }
    },
    "diagrams": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["event-flow", "sequence", "topology"]
          },
          "content": { "type": "string" },
          "format": { "type": "string" }
        }
      }
    },
    "handoff": {
      "type": "object",
      "properties": {
        "next_agents": {
          "type": "array",
          "items": { "type": "string" }
        },
        "artifacts": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
